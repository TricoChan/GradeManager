<!DOCTYPE html>
<html lang="en">
<head>
<!-- Basic Page Needs
    ================================================== -->
<meta http-equiv="Content-Type" content="text/html" charset="utf-8">
<!--[if IE]><meta http-equiv="x-ua-compatible" content="IE=9" /><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>学生作业系统</title>
<meta name="description" content="Your Description Here">
<meta name="keywords"
	content="bootstrap themes, portfolio, responsive theme">
<meta name="author" content="ThemeForces.Com">

<!-- Favicons
    ================================================== -->
<link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
<link rel="apple-touch-icon" href="img/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="72x72"
	href="img/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="114x114"
	href="img/apple-touch-icon-114x114.png">

<!-- Bootstrap -->
<link rel="stylesheet" type="text/css" href="css/bootstrap.css">
<link rel="stylesheet" type="text/css"
	href="fonts/font-awesome/css/font-awesome.css">

<!-- Stylesheet
    ================================================== -->
<link rel="stylesheet" type="text/css" href="css/style.css">
<link rel="stylesheet" type="text/css" href="css/responsive.css">

<script type="text/javascript" src="js/modernizr.custom.js"></script>

<link
	href='http://fonts.googleapis.com/css?family=Raleway:500,600,700,100,800,900,400,200,300'
	rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Playball'
	rel='stylesheet' type='text/css'>

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->
<!--                                              登录模态框                                                                                                                               -->
<!---------------------------------------------------------------------------------------------------------->
<!---------------------------------------------------------------------------------------------------------->

<body onload="fetchData();display();">
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">×</button>
					<h4 class="modal-title" id="myModalLabel">账户验证</h4>
				</div>
				<form id="student">
					<div class="modal-body" class="form-group">
						学号<input type="text" id="studentNum" name="studentNum"
							class="form-control">
					</div>

					<div class="modal-body" class="form-group">
						密码 <input type="password" id="password" name="password"
							class="form-control">
					</div>
					<div class="modal-footer" class="form-group">
						<div id="message"></div>
						<div class="row">
							<div class="col-md-4 col-md-offset-3">
								<button id="btn-login" class="btn btn-primary"
									onclick="login(this.form)" type="button">账户登录</button>
							</div>
							<div class="col-md-4">
								<button id="btn-register" class="btn btn-default"
									onclick="regist(this.form)" type="button">修改密码</button>
							</div>
						</div>
					</div>
				</form>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->


	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              主页部分                                                                                                                                   -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->

	<div id="tf-home">
		<div class="overlay">
			<div id="sticky-anchor"></div>
			<nav id="tf-menu" class="navbar navbar-default">
				<div class="container">
					<!-- Brand and toggle get grouped for better mobile display -->
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed"
							data-toggle="collapse"
							data-target="#bs-example-navbar-collapse-1">
							<span class="sr-only">Toggle navigation</span> <span
								class="icon-bar"></span> <span class="icon-bar"></span> <span
								class="icon-bar"></span>
						</button>
						<a class="navbar-brand logo" id="userid"></a>
					</div>

					<!-- Collect the nav links, forms, and other content for toggling -->
					<div class="collapse navbar-collapse"
						id="bs-example-navbar-collapse-1">
						<ul class="nav navbar-nav navbar-right">
							<li><a href="#tf-home">主页</a></li>
							<li><a href="#tf-portfolio">公告</a></li>
							<li><a href="#tf-about">成绩查询</a></li>
							<li><a href="#tf-why-me">作业提交</a></li>
							<li><a href="#tf-contact">留言</a></li>
							<li><a data-toggle="modal" data-target="#myModal">账户</a></li>
						</ul>
					</div>
					<!-- /.navbar-collapse -->
				</div>
				<!-- /.container-fluid -->
			</nav>

			<div class="container">
				<div class="content">
					<h1>作 业 信 息 系 统</h1>
					<h3>便 捷 ， 高 效 ，学 习 ， 沟 通</h3>
					<br> <a class="btn btn-primary my-btn" data-toggle="modal"
						data-target="#myModal">登 录</a> <a class="btn btn-primary my-btn2"
						data-toggle="modal" data-target="#myModal">更 正</a>
				</div>
			</div>
		</div>
	</div>

	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                                    公告部分                                                                                                                   -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<div id="tf-portfolio">
		<div class="container">
			<div class="section-title">
				<h3>公告</h3>
				<hr>
				<p>最新公告显示为空时请稍作等待，正在从数据库读取</p>
				<a1 class="section-title" onclick="workAll()">全部公告</a1>
			</div>

			<div class="space"></div>

			<div class="row">

				<div class="col-md-4">
					<div class="mask">
						<div id="show-work1" class="textonimg"></div>
						<img src="img/black.jpg" class="img-responsive">
					</div>
				</div>

				<div class="col-md-4">
					<div class="mask">
						<div id="show-work2" class="textonimg"></div>
						<img src="img/black.jpg" class="img-responsive">
					</div>
				</div>

				<div class="col-md-4">
					<div class="mask">
						<div id="show-work3" class="textonimg"></div>
						<img src="img/black.jpg" class="img-responsive">
					</div>
				</div>
			</div>
		</div>
	</div>


	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              成绩查询部分                                                                                                                           -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->

	<div id="tf-about">
		<div class="overlay">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-md-offset-9">
						<h3>成绩查询</h3>
						<br>
						<p>单次作业成绩</p>
						<p>平时成绩查询</p>
						<p>卷面成绩查询</p>
						<p>学期末总成绩</p>
						<br>
						<!-- 按钮触发模态框 -->
						<button type="button" class="btn btn-primary my-btn dark"
							onclick="query()">查询</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              提交作业部分                                                                                                                           -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->

	<div id="tf-why-me">
		<div class="overlay">
			<div class="container">
				<div class="row">
					<div class="col-md-6">
						<h3>提交作业</h3>
						<br>
						<form id="work-up" method="post" enctype="multipart/form-data"
							action="upload">
							<ul class="list-unstyled">
								<li>
									<h4>上传文件要求</h4>
									<p>请选择小于16M的文件，文件类型限定为.doc/.docx，同次作业仅最后一次提交的文件有效</p>
								</li>
								<li>
									<h4>选择作业代码</h4>
									<p>作业代码下拉为空时请稍作等待，作业代码正在从数据库读取</p>
									<div class="form-group">
										<select class="form-control" name="show-num" id="show-num"
											onchange="selectOnchange(this)">
										</select>
									</div>
								</li>
								<li>
									<h4>选择作业文件</h4>
									<div class="form-group">
										<input type="file" id="inputfile" name="inputfile">
									</div>
								</li>
							</ul>
							<button id="btn_upload" name="btn_upload" type="button"
								class="btn btn-primary my-btn dark" onclick="upLoad(this.form)">上
								传</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>



	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              留言板部分                                                                                                                               -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->

	<div id="tf-contact">
		<div class="container">
			<div class="section-title">
				<h3>留言板</h3>
				<a1 class="section-title" onclick="queryReply()">查看回复</a1>
				<a1 class="section-title" onclick="noteAll()">所有留言</a1>
				<p>课上课下学习的疑惑，对课堂好的建议想法，留言给老师一起交流吧</p>
				<hr>
			</div>

			<div class="space"></div>

			<div class="row">
				<div class="col-md-6 col-md-offset-3">
					<form id="contact" method="post" action="note-insert">
						<div class="form-group">
							<select class="form-control" name="note-selectType"
								id="note-selectType" onchange="selectOnchang(this)">
								<option value="学术交流">学术交流</option>
								<option value="课后答疑">课后答疑</option>
								<option value="课程建议">课程建议</option>
								<option value="日常生活">日常生活</option>
								<option value="其他">其他</option>
							</select>
						</div>
						<div class="form-group">
							<textarea class="form-control" rows="4" placeholder="留言"
								name="note-content" id="note-content"></textarea>
						</div>
						<button type="button" class="btn btn-primary my-btn dark"
							onclick="noteInsert(this.form)">提交留言</button>

					</form>
				</div>
			</div>
		</div>
	</div>

	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              footer                                                  -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->


	<nav id="tf-footer">
		<div class="container">
			<div class="text-center">
				<p>
					2018 © Trico. All Rights Reserved.<a href="http://www.neuq.edu.cn/"
						target="_blank" title="东北大学秦皇岛分校"> - Northeastern University
						at Qinhuangdao</a>
				</p>
			</div>
		</div>
	</nav>

	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->
	<!--                                              javascript                                              -->
	<!---------------------------------------------------------------------------------------------------------->
	<!---------------------------------------------------------------------------------------------------------->

	<script>
		$(function() {
			$('#myModal').modal('hide')
		});
	</script>
	<script>
		$(function() {
			$('#myModal').on('hide.bs.modal', function() {
				alert('...');
			})
		});
	</script>
	<script>
		//多个ajax任务单独写响应
		var xmlhttp;

		function loadXMLDoc(url, cfunc) {

			if (window.XMLHttpRequest) {// IE7+, Firefox, Chrome, Opera, Safari 代码
				xmlhttp = new XMLHttpRequest();
			} else {// IE6, IE5 代码
				xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
			}
			xmlhttp.onreadystatechange = cfunc;
			xmlhttp.open("GET", url, false);
			xmlhttp.send();
		}

		// 显示登录信息
		function display() {
			$("#userid").text(getCookie("studentNum"));
		}

		//检查cookie

		function getCookie(cname) {
			var name = cname + "=";
			var ca = document.cookie.split(';');
			for (var i = 0; i < ca.length; i++) {
				var c = ca[i].trim();
				if (c.indexOf(name) == 0)
					//console.log(c.substring(name.length, c.length));
					return c.substring(name.length, c.length);
			}
			return "";
		}

		//检查登录状态

		function checkLogin() {
			var studentNum = getCookie("studentNum");
			if (studentNum == "" || !studentNum) {
				alert("请先登录");
				return false;
			} else {
				return true;
			}
		}

		//预处理数据

		function fetchData() {
			loadXMLDoc("/GradeManager/pre-fetch", function() {
				if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
					var str = xmlhttp.responseText;
					var n = str.split("  ");
					document.getElementById("show-num").innerHTML = n[0];
					document.getElementById("show-work1").innerHTML = n[1];
					document.getElementById("show-work2").innerHTML = n[2];
					document.getElementById("show-work3").innerHTML = n[3];
				}
			});
		}

		//登录

		function login(form) {

			var accountName = $("#studentNum"), $password = $("#password");
			var accountName = accountName.val(), password = $password.val();
			//防止输入中文崩溃
			accountName = encodeURI(accountName);
			if (!accountName || accountName == "") {
				showMsg("请输入学号");
				form.accountName.focus();
				return false;
			}
			if (!password || password == "") {
				showMsg("请输入密码");
				form.password.focus();
				return false;
			}
			showMsg("登录中，请稍候...");
			submitData();
			display();

			function showMsg(msg) {
				$("#message").text(msg);
			}

			//回车键提交
			$(function() {
				document.onkeydown = keyDownSearch;
				function keyDownSearch(e) {
					// 兼容FF和IE和Opera
					var theEvent = e || window.event;
					var code = theEvent.keyCode || theEvent.which
							|| theEvent.charCode;
					if (code == 13) {
						$('#btn-login').click();
						showMsg("登录中，请稍候...");
						submitData();
						display();
						return false;
					}
					return true;
				}
			});

			//登录提交数据

			function submitData() {

				loadXMLDoc("/GradeManager/login?studentNum=" + accountName
						+ "&password=" + password, function() {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						//必须用trim(),否则格式有误会判断失败
						var msg = xmlhttp.responseText.trim();
						if (msg == "success") {
							$('#myModal').modal('hide');
							showMsg("");
							alert("登录成功");
						} else if (msg == "number") {
							showMsg("学号只能为数字或长度超限");
							alert("登录失败");
						} else if (msg == "notmatch") {
							showMsg("密码错误");
							alert("登录失败");
						} else if (msg == "error") {
							showMsg("学号错误");
							alert("登录失败");
						} else {
							showMsg("");
							alert("登录失败");
						}
					}
				});
			}

		}

		//修改密码
		function regist(form) {
			//检测登录
			if (checkLogin()) {

				var studentNum = $("#studentNum"), $password = $("#password");
				var studentNum = studentNum.val(), password = $password.val();
				//防止输入中文崩溃
				studentNum = encodeURI(studentNum);
				if (!studentNum || studentNum == "") {
					showMsg("请输入学号");
					form.studentNum.focus();
					return false;
				}
				if (!password || password == "") {
					showMsg("请输入密码");
					form.password.focus();
					return false;
				}
				if (studentNum != getCookie("studentNum")) {
					showMsg("只能修改自己的学号");
					form.studentNum.focus();
					return false;
				}
				showMsg("修改中，请稍候...");
				registData();
			}

			function showMsg(msg) {
				$("#message").text(msg);
			}

			//注册提交数据

			function registData() {

				loadXMLDoc("/GradeManager/regist?studentNum=" + studentNum
						+ "&password=" + password, function() {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						//必须用trim(),否则格式有误会判断失败
						var msg = xmlhttp.responseText.trim();
						if (msg == "correct") {
							$('#myModal').modal('hide');
							showMsg("");
							alert("修改成功");
						} else if (msg == "notnum") {
							showMsg("学号只能为数字或长度超限");
							alert("修改失败");
						} else if (msg == "exist") {
							showMsg("学号不存在");
							alert("修改失败");
						} else {
							showMsg("未知原因");
							alert("修改失败");
						}
					}
				});
			}

		}
	</script>
	<script>
		//查询成绩
		function query() {
			if (checkLogin()) {
				location.href = "http://localhost:8080/GradeManager/grade-query";
			}

		}
	</script>
	<script>
		//查询回复
		function queryReply() {
			if (checkLogin()) {
				location.href = "http://localhost:8080/GradeManager/my-note";
			}
		}
	</script>
	<script>
		//所有留言
		function noteAll() {
			location.href = "http://localhost:8080/GradeManager/note-all";
		}
	</script>
	<script>
		//所有公告
		function workAll() {
			location.href = "http://localhost:8080/GradeManager/work-all";
		}
	</script>
	<script>
		//上传作业
		function upLoad(form) {
			if (checkLogin()) {

				var num = $("#show-num");
				var num = num.val();
				//防止输入中文崩溃
				num = encodeURI(num);

				if (!num || num == "") {
					alert("未选择作业代码");
					return;
				}

				var input = document.getElementById("inputfile");
				var path = input.value;

				if (!path || path == "") {
					alert("请选择文件");
					return;
				}

				var filesize = input.files[0].size;
				console.log(filesize);
				if (filesize > 1024 * 1024 * 16) {
					alert("文件大小超限");
					return;
				}

				var suffix = path.lastIndexOf(".");
				var result = path.substring(suffix + 1);

				if (result != "doc" && result != "docx") {
					alert("请选择格式为.doc/.docx的文件");
					return;
				}

				form.action = "upload";
				form.submit();

			}
		}
	</script>
	<script>
		//上传留言
		function noteInsert(form) {
			if (checkLogin()) {
				var type = $("#note-selectType"), $content = $("#note-content");
				var type = type.val(), content = $content.val();
				//防止输入中文崩溃
				type = encodeURI(type);
				content = encodeURI(content);
				if (!type || type == "") {
					alert("未选择类型");
					return;
				}
				if (!content || content == "") {
					alert("未填写留言");
					return;
				}
				form.action = "note-insert";
				form.submit();
			}
		}
	</script>
	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script type="text/javascript" src="js/jquery.1.11.1.js"></script>
	<script type="text/javascript" src="js/jquery-1.11.2.min.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script type="text/javascript" src="js/bootstrap.js"></script>

	<!-- Javascripts
    ================================================== -->
	<script type="text/javascript" src="js/main.js"></script>
</body>
</html>